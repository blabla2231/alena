<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ - –î–µ–º–æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        :root {
            --bg-color: #f3f4f6; --text-color: #111827; --button-color: #2563eb; --button-text-color: #ffffff;
            --secondary-bg-color: #ffffff; --hint-color: #6b7280; --link-color: #2563eb; --header-bg-color: #ffffff;
        }
        .page, .modal-overlay { display: none; }
        .page.active { display: flex; animation: fadeIn 0.3s ease-out; }
        .tab-bar-item.active { color: var(--link-color); }
        .modal-overlay.active { display: flex; animation: fadeIn 0.2s ease-out; }
        .modal-content { animation: slideInUp 0.3s ease-out; }
        .notification { animation: slideInDown 0.3s ease-out forwards; }
        .notification.closing { animation: fadeOutUp 0.3s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideInDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        @keyframes fadeOutUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-100%); } }
        .watermark { position: fixed; bottom: 10px; right: 10px; font-size: 10px; color: rgba(0,0,0,0.1); pointer-events: none; transform: rotate(-15deg); }
    </style>
</head>
<body class="bg-gray-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="mb-4 flex space-x-2">
        <button id="show-client-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow-lg">üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å </button>
        <button id="show-admin-btn" class="px-4 py-2 bg-gray-600 text-white rounded-lg shadow-lg">‚öôÔ∏è –ê–¥–º–∏–Ω</button>
    </div>

    <div id="app-wrapper" class="relative bg-[var(--bg-color)] text-[var(--text-color)] w-full max-w-[420px] h-[800px] rounded-2xl shadow-2xl border-8 border-black overflow-hidden flex flex-col">
        <!-- Notification Area -->
        <div id="notification-area" class="absolute top-0 left-0 right-0 p-2 z-50"></div>
        
        <!-- CLIENT APP -->
        <div id="client-app" class="h-full flex flex-col">
            <header class="bg-[var(--header-bg-color)] p-4 flex justify-between items-center border-b border-gray-200 shrink-0">
                <button data-action="go-back" class="hidden text-3xl font-bold text-[var(--link-color)]">‚Äπ</button>
                <h1 id="client-header-title" class="font-bold text-lg">–ì–ª–∞–≤–Ω–∞—è</h1>
                <a href="https://t.me/All_Modx" target="_blank" class="font-semibold text-[var(--link-color)] text-sm">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            </header>
            <main id="client-main" class="flex-grow overflow-y-auto"></main> <!-- Pages will be injected here -->
            <nav class="bg-[var(--header-bg-color)] p-2 flex justify-around border-t border-gray-200 shrink-0">
                <button data-target="client-home" class="client-tab-item active flex flex-col items-center w-full py-1">üè†<span class="text-xs font-medium">–ì–ª–∞–≤–Ω–∞—è</span></button>
                <button data-target="client-referrals" class="client-tab-item flex flex-col items-center w-full py-1 text-gray-500">üîó<span class="text-xs font-medium">–†–µ—Ñ–µ—Ä–∞–ª—ã</span></button>
                <button data-target="client-balance" class="client-tab-item flex flex-col items-center w-full py-1 text-gray-500">üí∞<span class="text-xs font-medium">–ë–∞–ª–∞–Ω—Å</span></button>
                <button data-target="client-profile" class="client-tab-item flex flex-col items-center w-full py-1 text-gray-500">üë§<span class="text-xs font-medium">–ü—Ä–æ—Ñ–∏–ª—å</span></button>
            </nav>
        </div>

        <!-- ADMIN APP -->
        <div id="admin-app" class="h-full flex flex-col hidden bg-gray-100">
            <header class="bg-gray-800 text-white p-4 flex justify-between items-center shrink-0">
                <button data-action="go-back" class="hidden text-3xl font-bold">‚Äπ</button>
                <h1 id="admin-header-title" class="font-bold text-lg">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
                <button data-action="admin-logout" class="font-semibold text-sm opacity-80 hover:opacity-100">–í—ã–π—Ç–∏</button>
            </header>
            <main id="admin-main" class="flex-grow overflow-y-auto"></main> <!-- Pages will be injected here -->
            <nav class="bg-gray-800 p-2 flex justify-around text-white shrink-0">
                <button data-target="admin-dashboard" class="admin-tab-item active flex flex-col items-center w-full py-1">üìä<span class="text-xs font-medium">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span></button>
                <button data-target="admin-users" class="admin-tab-item flex flex-col items-center w-full py-1 opacity-70">üë•<span class="text-xs font-medium">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span></button>
                <button data-target="admin-payouts" class="admin-tab-item flex flex-col items-center w-full py-1 opacity-70">üí∏<span class="text-xs font-medium">–í—ã–≤–æ–¥—ã</span></button>
                <button data-target="admin-settings" class="admin-tab-item flex flex-col items-center w-full py-1 opacity-70">‚öôÔ∏è<span class="text-xs font-medium">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
            </nav>
        </div>

        <div id="watermark" class="watermark"></div>
        <div id="modal-container"></div> <!-- Modals will be injected here -->
    </div>

<script>
// --- –ò–ú–ò–¢–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–• ---
const DB = {
    currentUser: { id: 1, name: '–ê–ª–µ–Ω–∞', tg: '@alena_manager', balance: 7500 },
    users: [
        { id: 2, name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', tg: '@ivan_p', regDate: '17.09.25', referrerId: 1, paid: true, balance: 1500 },
        { id: 3, name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', tg: '@maria_s', regDate: '16.09.25', referrerId: 2, paid: true, balance: 1000 },
        { id: 4, name: '–ü–µ—Ç—Ä –ö–æ–∑–ª–æ–≤', tg: '@petr_k', regDate: '15.09.25', referrerId: 1, paid: false, balance: 0 },
        { id: 5, name: '–ê–Ω–Ω–∞ –õ–µ–±–µ–¥–µ–≤–∞', tg: '@anna_l', regDate: '14.09.25', referrerId: 1, paid: true, balance: 0 },
    ],
    payouts: [
        { id: 1, userId: 1, amount: 2000, status: 'approved', date: '15.09.25', requisites: '–ö–∞—Ä—Ç–∞ **** 1234' },
        { id: 2, userId: 2, amount: 1500, status: 'pending', date: '18.09.25', requisites: 'USDT TRC20 T...xyz' },
        { id: 3, userId: 3, amount: 1000, status: 'rejected', date: '16.09.25', requisites: '–ö–∞—Ä—Ç–∞ **** 5678' },
    ],
    tariffs: [
        { id: 1, name: '1 –º–µ—Å—è—Ü', price: 990, active: true },
        { id: 2, name: '3 –º–µ—Å—è—Ü–∞', price: 2490, active: false },
        { id: 3, name: '1 –≥–æ–¥', price: 7990, active: false },
    ],
    content: [
        { id: 'c1', title: 'üìò –ì–∞–π–¥: –ö–∞–∫ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤', locked: false, body: '<h2>–ü–æ–ª–Ω—ã–π –≥–∞–π–¥</h2><p>–®–∞–≥ 1: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à—É —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É. –®–∞–≥ 2: –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ—é —Å –¥—Ä—É–∑—å—è–º–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö. –®–∞–≥ 3: –ü–æ–ª—É—á–∞–π—Ç–µ –∫—ç—à–±—ç–∫ —Å –∫–∞–∂–¥–æ–π –∏—Ö –æ–ø–ª–∞—Ç—ã!</p>' },
        { id: 'c2', title: 'üìà –°—Ç–∞—Ç—å—è: –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ 2025', locked: false, body: '<h2>–ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞</h2><p>–í 2025 –≥–æ–¥—É –æ–∂–∏–¥–∞–µ—Ç—Å—è —Ä–æ—Å—Ç –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º. –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã –≤–∫–ª—é—á–∞—é—Ç... (—Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏)...</p>' },
        { id: 'c3', title: 'üîí –°–µ–∫—Ä–µ—Ç—ã –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞', locked: true, body: '<h2>–°–µ–∫—Ä–µ—Ç—ã –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞</h2><p>–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –≥–æ–¥–æ–≤–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞.</p>' },
    ],
    settings: { referralBonus: 15 }
};

// --- –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï –î–ï–ú–û ---
const AppState = {
    currentApp: 'client',
    client: { currentPage: 'client-home', history: ['client-home'] },
    admin: { currentPage: 'admin-dashboard', history: ['admin-dashboard'] },
};

// --- –®–ê–ë–õ–û–ù–´ –°–¢–†–ê–ù–ò–¶ (VIEWS) ---
const Views = {
    // Client pages
    'client-home': () => `<div class="p-4 space-y-4">${DB.content.map(c => `<div data-action="view-content" data-content-id="${c.id}" class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-50"><p class="font-semibold">${c.title}</p><span class="text-2xl">${c.locked ? 'üîí' : '‚Ä∫'}</span></div>`).join('')}</div>`,
    'client-referrals': () => {
        const myReferrals = DB.users.filter(u => u.referrerId === DB.currentUser.id);
        const paidCount = myReferrals.filter(u => u.paid).length;
        return `<div class="p-4 space-y-4">
            <div class="bg-white p-4 rounded-xl shadow-sm text-center">
                <h2 class="font-bold">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</h2>
                <input type="text" value="https://t.me/our_bot?start=ref${DB.currentUser.id}" readonly class="w-full bg-gray-100 p-2 rounded-lg text-center mt-2 text-sm">
                <button data-action="copy-link" class="mt-2 w-full bg-[var(--button-color)] text-white font-bold py-2 rounded-lg">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div class="grid grid-cols-3 gap-2 text-center">
                <div class="bg-white p-2 rounded-lg"><p class="font-bold text-lg">${myReferrals.length}</p><p class="text-xs text-gray-500">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</p></div>
                <div class="bg-white p-2 rounded-lg"><p class="font-bold text-lg">${paidCount}</p><p class="text-xs text-gray-500">–û–ø–ª–∞—Ç–∏–ª–∏</p></div>
                <div class="bg-white p-2 rounded-lg"><p class="font-bold text-lg">${DB.currentUser.balance.toLocaleString('ru')}‚ÇΩ</p><p class="text-xs text-gray-500">–ë–∞–ª–∞–Ω—Å</p></div>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm"><h2 class="font-bold mb-2">–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</h2><div class="space-y-2">${myReferrals.map(u => `<div class="flex justify-between items-center text-sm"><p>${u.name} (${u.tg})</p><span class="px-2 py-0.5 rounded-full text-xs ${u.paid ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">${u.paid ? '–û–ø–ª–∞—Ç–∏–ª' : '–ñ–¥–µ—Ç'}</span></div>`).join('') || '<p class="text-sm text-gray-500 text-center">–í—ã –ø–æ–∫–∞ –Ω–∏–∫–æ–≥–æ –Ω–µ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏.</p>'}</div></div>
        </div>`;
    },
    'client-balance': () => {
        const history = DB.payouts.filter(p => p.userId === DB.currentUser.id);
        const statusMap = { approved: ['‚úÖ', '–í—ã–≤–æ–¥ –æ–¥–æ–±—Ä–µ–Ω', 'text-green-600'], pending: ['‚è≥', '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ', 'text-yellow-600'], rejected: ['‚ùå', '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ', 'text-red-600'] };
        return `<div class="p-4 space-y-4">
            <div class="bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-6 rounded-xl shadow-lg text-center">
                <p class="text-sm opacity-80">–ö—ç—à–±—ç–∫-–±–∞–ª–∞–Ω—Å</p><p class="text-4xl font-bold mt-1">${DB.currentUser.balance.toLocaleString('ru')} ‚ÇΩ</p>
                <button data-action="show-payout-modal" class="mt-4 w-full bg-white text-blue-600 font-bold py-2.5 rounded-lg shadow-md">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥</button>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm"><h2 class="font-bold mb-2">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2><div class="space-y-3">${history.map(p => `<div class="flex justify-between items-center"><div class="flex items-center"><span class="mr-3 text-xl">${statusMap[p.status][0]}</span><div><p class="font-semibold text-sm ${statusMap[p.status][2]}">${statusMap[p.status][1]}</p><p class="text-xs text-gray-500">${p.date}</p></div></div><p class="font-bold text-sm">${p.amount} ‚ÇΩ</p></div>`).join('') || '<p class="text-sm text-gray-500 text-center">–û–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>'}</div></div>
        </div>`;
    },
    'client-profile': () => `
        <div class="p-4 space-y-4">
            <div class="bg-white p-4 rounded-xl shadow-sm flex items-center space-x-4">
                <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center text-2xl font-bold">${DB.currentUser.name[0]}</div>
                <div><h2 class="font-bold text-lg">${DB.currentUser.name}</h2><p class="text-sm text-gray-500">${DB.currentUser.tg}</p></div>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm"><h3 class="font-bold mb-2">–ú–æ—è –ø–æ–¥–ø–∏—Å–∫–∞</h3>${DB.tariffs.map(t => t.active ? `<p class="font-semibold text-green-600">–ê–∫—Ç–∏–≤–µ–Ω —Ç–∞—Ä–∏—Ñ "${t.name}" –¥–æ 24.10.2025</p>` : '').join('')}</div>
            <div class="bg-white p-4 rounded-xl shadow-sm"><h3 class="font-bold mb-2">–°–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ</h3>${DB.tariffs.map(t => `<div class="flex justify-between items-center mt-2 p-3 bg-gray-50 rounded-lg"><p class="font-semibold">${t.name}</p><button data-action="buy-tariff" data-price="${t.price}" class="bg-blue-100 text-blue-600 font-bold px-4 py-1.5 rounded-lg text-sm">${t.price.toLocaleString('ru')}‚ÇΩ</button></div>`).join('')}</div>
        </div>`,
    // Admin pages
    'admin-dashboard': () => {
        const totalUsers = DB.users.length + 1, paidCount = DB.users.filter(u => u.paid).length;
        const pendingPayouts = DB.payouts.filter(p => p.status === 'pending').length;
        return `<div class="p-4 space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-3 rounded-xl shadow-sm"><p class="text-sm text-gray-500">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p><p class="text-2xl font-bold">${totalUsers}</p></div>
                <div class="bg-white p-3 rounded-xl shadow-sm"><p class="text-sm text-gray-500">–° –ø–æ–¥–ø–∏—Å–∫–æ–π</p><p class="text-2xl font-bold">${paidCount}</p></div>
                <div class="bg-white p-3 rounded-xl shadow-sm"><p class="text-sm text-gray-500">–ó–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥</p><p class="text-2xl font-bold ${pendingPayouts > 0 ? 'text-orange-500' : ''}">${pendingPayouts}</p></div>
                <div class="bg-white p-3 rounded-xl shadow-sm"><p class="text-sm text-gray-500">–ë–æ–Ω—É—Å</p><p class="text-2xl font-bold">${DB.settings.referralBonus}%</p></div>
            </div>
        </div>`;
    },
    'admin-users': () => `
        <div class="p-4 space-y-3">
            <input type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ TG..." class="w-full p-2 border rounded-lg">
            <div class="space-y-2">${DB.users.map(u => `<div data-action="view-user" data-user-id="${u.id}" class="bg-white p-3 rounded-lg shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-50"><div><p class="font-semibold">${u.name}</p><p class="text-sm text-gray-500">${u.tg}</p></div><span class="text-2xl font-bold text-gray-400">‚Ä∫</span></div>`).join('')}</div>
        </div>`,
    'admin-user-detail': (userId) => {
        const user = DB.users.find(u => u.id === userId);
        const referrer = DB.users.find(u => u.id === user.referrerId) || DB.currentUser;
        const referrals = DB.users.filter(u => u.referrerId === userId);
        return `<div class="p-4 space-y-4">
            <div class="bg-white p-4 rounded-xl shadow-sm"><h2 class="font-bold text-lg">${user.name}</h2><p class="text-gray-500">${user.tg}</p></div>
            <div class="bg-white p-4 rounded-xl shadow-sm"><p class="text-sm text-gray-500">–ü—Ä–∏–≥–ª–∞—Å–∏–ª</p><p class="font-semibold">${referrer.name} (${referrer.tg})</p></div>
            <div class="bg-white p-4 rounded-xl shadow-sm"><p class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å</p><p class="font-semibold ${user.paid ? 'text-green-600' : 'text-yellow-600'}">${user.paid ? '–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞' : '–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏'}</p></div>
            <div class="bg-white p-4 rounded-xl shadow-sm"><p class="text-sm text-gray-500">–ë–∞–ª–∞–Ω—Å / –ü—Ä–∏–≥–ª–∞—Å–∏–ª</p><p class="font-semibold">${user.balance.toLocaleString('ru')} ‚ÇΩ / ${referrals.length} —á–µ–ª.</p></div>
            <div class="flex space-x-2"><button data-action="block-user" class="w-full bg-yellow-500 text-white font-bold py-3 rounded-lg">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button><button data-action="delete-user" class="w-full bg-red-600 text-white font-bold py-3 rounded-lg">–£–¥–∞–ª–∏—Ç—å</button></div>
        </div>`;
    },
    'admin-payouts': () => {
        const statusTranslations = { approved: '–û–¥–æ–±—Ä–µ–Ω–æ', pending: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ', rejected: '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ' };
        const statusMap = { approved: 'bg-green-100 text-green-700', pending: 'bg-yellow-100 text-yellow-700', rejected: 'bg-red-100 text-red-700' };
        return `<div class="p-4 space-y-3">${DB.payouts.map(p => {
            const user = DB.users.find(u => u.id === p.userId) || DB.currentUser;
            return `<div class="bg-white p-3 rounded-lg shadow-sm space-y-2">
                <div class="flex justify-between items-start"><p class="font-semibold">${user.name}</p><p class="font-bold text-lg">${p.amount} ‚ÇΩ</p></div>
                <p class="text-sm text-gray-500">–†–µ–∫–≤–∏–∑–∏—Ç—ã: ${p.requisites}</p>
                ${p.status === 'pending' ? `<div class="flex space-x-2 pt-2 border-t"><button data-action="approve-payout" data-payout-id="${p.id}" class="w-full bg-green-500 text-white font-semibold py-2 rounded-lg">–û–¥–æ–±—Ä–∏—Ç—å</button><button data-action="reject-payout" data-payout-id="${p.id}" class="w-full bg-red-500 text-white font-semibold py-2 rounded-lg">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button></div>`
                : `<div class="pt-2 border-t text-center font-semibold text-sm ${statusMap[p.status]} py-2 rounded-b-lg -m-3 mt-2">–°—Ç–∞—Ç—É—Å: ${statusTranslations[p.status]}</div>`}
            </div>`
        }).join('')}</div>`;
    },
    'admin-settings': () => `
        <div class="p-4 space-y-4">
            <div class="bg-white p-4 rounded-xl shadow-sm"><h2 class="font-bold mb-2">–û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <label class="font-semibold text-sm">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å (%):</label>
                <input type="number" id="bonus-input" value="${DB.settings.referralBonus}" class="w-full p-2 border rounded-lg mt-1">
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm"><h2 class="font-bold mb-2">–¢–∞—Ä–∏—Ñ—ã</h2>${DB.tariffs.map(t => `<div class="flex items-center space-x-2 mt-1"><label class="flex-1 font-semibold text-sm">${t.name}:</label><input type="number" value="${t.price}" class="w-2/4 p-2 border rounded-lg"></div>`).join('')}</div>
            <button data-action="save-settings" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </div>`,
};

// --- –û–°–ù–û–í–ù–û–ô –î–í–ò–ñ–û–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
document.addEventListener('DOMContentLoaded', () => {
    const mainContainers = { client: document.getElementById('client-main'), admin: document.getElementById('admin-main') };
    const headerTitles = { client: document.getElementById('client-header-title'), admin: document.getElementById('admin-header-title') };
    const backBtns = { client: document.querySelector('#client-app [data-action="go-back"]'), admin: document.querySelector('#admin-app [data-action="go-back"]') };
    const modalContainer = document.getElementById('modal-container');
    const notificationArea = document.getElementById('notification-area');

    function renderPage(pageId, pageData) {
        const app = AppState.currentApp;
        mainContainers[app].innerHTML = Views[pageId](pageData);
        headerTitles[app].textContent = {
            'home': '–ì–ª–∞–≤–Ω–∞—è', 'referrals': '–†–µ—Ñ–µ—Ä–∞–ª—ã', 'balance': '–ë–∞–ª–∞–Ω—Å', 'profile': '–ü—Ä–æ—Ñ–∏–ª—å',
            'dashboard': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 'users': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏', 'payouts': '–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥', 'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
            'user-detail': '–ü—Ä–æ—Ñ–∏–ª—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'
        }[pageId.split('-')[1]] || '–î–µ—Ç–∞–ª–∏';
        
        document.querySelectorAll(`.${app}-tab-item`).forEach(item => {
            item.classList.toggle('active', item.dataset.target === pageId);
            item.classList.toggle('text-gray-500', item.dataset.target !== pageId && app === 'client');
            item.classList.toggle('opacity-70', item.dataset.target !== pageId && app === 'admin');
        });
    }

    function navigateTo(pageId, pageData) {
        const app = AppState.currentApp;
        if (AppState[app].currentPage !== pageId) {
            AppState[app].history.push(pageId);
        }
        AppState[app].currentPage = pageId;
        backBtns[app].classList.toggle('hidden', AppState[app].history.length <= 1);
        renderPage(pageId, pageData);
    }

    function goBack() {
        const app = AppState.currentApp;
        if (AppState[app].history.length > 1) {
            AppState[app].history.pop();
            const prevPage = AppState[app].history[AppState[app].history.length - 1];
            AppState[app].currentPage = prevPage;
            backBtns[app].classList.toggle('hidden', AppState[app].history.length <= 1);
            renderPage(prevPage);
        }
    }

    function showModal(content) {
        modalContainer.innerHTML = `<div class="modal-overlay active bg-black bg-opacity-50 fixed inset-0 flex items-center justify-center p-4 z-40"><div class="modal-content bg-white rounded-xl shadow-lg w-full max-w-sm">${content}</div></div>`;
    }

    function closeModal() { modalContainer.innerHTML = ''; }
    
    function showNotification(message, isSuccess = true) {
        const bgColor = isSuccess ? 'bg-green-500' : 'bg-red-500';
        const notif = document.createElement('div');
        notif.className = `notification ${bgColor} text-white font-semibold p-3 rounded-b-lg shadow-lg`;
        notif.textContent = message;
        notificationArea.appendChild(notif);
        setTimeout(() => {
            notif.classList.add('closing');
            notif.addEventListener('animationend', () => notif.remove());
        }, 2000);
    }

    // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–ï–ô–°–¢–í–ò–ô ---
    document.getElementById('app-wrapper').addEventListener('click', e => {
        const target = e.target.closest('[data-action], [data-target]');
        if (!target) return;

        const { action, target: targetPage, ...data } = target.dataset;

        if (targetPage) { // Tab bar navigation
            navigateTo(targetPage);
            return;
        }

        switch (action) {
            case 'go-back': goBack(); break;
            case 'copy-link': 
                navigator.clipboard.writeText(`https://t.me/our_bot?start=ref${DB.currentUser.id}`);
                showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                break;
            case 'view-content': {
                const content = DB.content.find(c => c.id === data.contentId);
                if (content.locked) {
                    showNotification('–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', false);
                } else {
                    showModal(`<div class="p-4">${content.body}</div><button data-action="close-modal" class="w-full text-center py-3 border-t font-bold text-blue-600">–ó–∞–∫—Ä—ã—Ç—å</button>`);
                }
                break;
            }
            case 'show-payout-modal':
                showModal(`<div class="p-4 space-y-2"><h3 class="font-bold text-lg">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3><p class="text-sm">–î–æ—Å—Ç—É–ø–Ω–æ: ${DB.currentUser.balance.toLocaleString('ru')} ‚ÇΩ</p><input type="number" id="payout-amount" placeholder="–°—É–º–º–∞" class="w-full p-2 border rounded-lg"><input type="text" id="payout-reqs" placeholder="–†–µ–∫–≤–∏–∑–∏—Ç—ã (–∫–∞—Ä—Ç–∞, USDT)" class="w-full p-2 border rounded-lg"></div><div class="flex border-t"><button data-action="close-modal" class="w-1/2 text-center py-3 font-semibold">–û—Ç–º–µ–Ω–∞</button><button data-action="submit-payout" class="w-1/2 text-center py-3 font-bold text-blue-600 border-l">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div>`);
                break;
            case 'submit-payout':
                const amount = document.getElementById('payout-amount').value;
                if (amount && amount > 0 && amount <= DB.currentUser.balance) {
                    showNotification('–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
                    closeModal();
                } else {
                    showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞!', false);
                }
                break;
            case 'buy-tariff': showNotification(`–ü–æ–∫—É–ø–∫–∞ —Ç–∞—Ä–∏—Ñ–∞ –∑–∞ ${data.price}‚ÇΩ...`); break;
            case 'view-user': navigateTo('admin-user-detail', parseInt(data.userId)); break;
            case 'approve-payout':
                DB.payouts.find(p => p.id === parseInt(data.payoutId)).status = 'approved';
                showNotification('–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!');
                renderPage('admin-payouts');
                break;
            case 'reject-payout':
                DB.payouts.find(p => p.id === parseInt(data.payoutId)).status = 'rejected';
                showNotification('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
                renderPage('admin-payouts');
                break;
            case 'save-settings': showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!'); break;
            case 'admin-logout': showNotification('–í—ã—Ö–æ–¥ –∏–∑ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è...'); break;
            case 'block-user': showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', false); break;
            case 'delete-user': showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω', false); break;
            case 'close-modal': closeModal(); break;
        }
    });

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    function init() {
        document.getElementById('show-client-btn').onclick = () => { AppState.currentApp = 'client'; switchApp(true); };
        document.getElementById('show-admin-btn').onclick = () => { AppState.currentApp = 'admin'; switchApp(false); };
        
        function switchApp(isClient) {
            document.getElementById('client-app').classList.toggle('hidden', !isClient);
            document.getElementById('admin-app').classList.toggle('hidden', isClient);
            document.getElementById('show-client-btn').classList.toggle('ring-2', isClient);
            document.getElementById('show-admin-btn').classList.toggle('ring-2', !isClient);
            navigateTo(isClient ? AppState.client.currentPage : AppState.admin.currentPage);
        }

        const today = new Date();
        document.getElementById('watermark').textContent = `–î–µ–º–æ –¥–ª—è –ê–ª–µ–Ω—ã. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ. ${today.toLocaleDateString('ru-RU')}`;

        switchApp(true);
    }
    init();
});
</script>
</body>
</html>

